<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Math Sprint</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0f172a;
      color: #f8fafc;
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding-bottom: env(safe-area-inset-bottom);
    }

    .app {
      width: 100%;
      max-width: 420px;
      padding: 15px;
      text-align: center;
/*      display: flex; */
      flex-direction: column;
      justify-content: space-between;
      height: 100vh;
      box-sizing: border-box;
      padding-bottom: 20px; /* extra space for Android nav bar */
    }

    h1 {
      font-size: 2rem;
    }

    .timer {
      font-size: 1.2rem;
      margin-bottom: 16px;
    }

    .problem {
      background: #1e293b;
      border-radius: 16px;
      padding: 10px 20px;
      font-size: 2.5rem;
      margin: 20px 0;
      user-select: none;
      transition: background 0.15s ease;
    }

    .flash-correct {
      background: #16a34a !important;
    }

    .flash-wrong {
      background: #dc2626 !important;
    }

    .answer {
      width: 50%;
      font-size: 2rem;
      padding: 12px;
      border-radius: 12px;
      border: none;
      text-align: center;
      margin-bottom: 20px;
    }

    .answer:disabled {
      background-color: white;
      cursor: not-allowed;
    }

    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
      margin-bottom: 10px;
    }

    .keypad button,
    .cta-btn {
      width: 100%;
      padding: 15px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      background: #1a57bb;
      color: #f8fafc;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .keypad button:active,
    .cta-btn:active {
      transform: scale(0.96);
    }

    .submit-btn {
      background: #0d883a;
      margin-top: 20px;
    }

    .hidden {
      display: none;
    }

    .results {
      font-size: 1.4rem;
      margin: 40px 0px;
    }

    .progress-container {
      width: 100%;
      height: 12px;
      background: #334155; /* dark background behind bar */
      border-radius: 6px;
      margin-bottom: 16px;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      width: 100%; /* starts full */
      background-color: #16a34a; /* green initially */
      transition: width 0.2s linear, background-color 0.2s linear;
    }

  </style>
</head>
<body>
  <div class="app">
    <div>
      <h1>Math Sprint</h1>

      <button id="startBtn" class="cta-btn">Start</button>

      <div id="timer" class="timer hidden">‚è± 10</div>

      <div id="progressContainer" class="progress-container hidden">
        <div id="progressBar" class="progress-bar"></div>
      </div>

      <div id="problem" class="problem hidden">4 √ó 9</div>

      <input id="answer" class="answer hidden" type="text" inputmode="numeric" disabled />

      <div id="keypad" class="keypad hidden"></div>
    </div>

    <div style="padding-bottom: env(safe-area-inset-bottom);">
      <div id="results" class="results hidden"></div>
      <button id="submitBtn" class="cta-btn submit-btn hidden">Submit</button>
    </div>
  </div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const timerEl = document.getElementById('timer');
    const problemEl = document.getElementById('problem');
    const answerEl = document.getElementById('answer');
    const keypadEl = document.getElementById('keypad');
    const resultsEl = document.getElementById('results');
    const submitBtn = document.getElementById('submitBtn');

    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    
    function updateProgressBar() {
      const percent = (timeLeft / 60) * 100;
      progressBar.style.width = percent + '%';
    
      // Color logic: green >10, yellow 10‚Äì3, red <=3
      if (timeLeft > 10) {
        progressBar.style.backgroundColor = '#16a34a'; // green
      } else if (timeLeft <= 10 && timeLeft > 3) {
        progressBar.style.backgroundColor = '#facc15'; // yellow
      } else {
        progressBar.style.backgroundColor = '#dc2626'; // red
      }
    }
    

    let a = 0;
    let b = 0;
    let timeLeft = 60;
    let timerId = null;
    let correct = 0;
    let wrong = 0;

    function randomProblem() {
      a = Math.floor(Math.random() * 13);
      b = Math.floor(Math.random() * 13);
      problemEl.textContent = `${a} √ó ${b}`;
    }

    function submitAnswer() {
      const userAnswer = answerEl.value === '' ? 0 : parseInt(answerEl.value, 10);
      const isCorrect = userAnswer === a * b;

      if (isCorrect) {
        correct++;
        problemEl.classList.add('flash-correct');
      } else {
        wrong++;
        problemEl.classList.add('flash-wrong');
      }

      setTimeout(() => {
        problemEl.classList.remove('flash-correct', 'flash-wrong');
        answerEl.value = '';
        randomProblem();
      }, 150);
    }

    function startGame() {
      correct = 0;
      wrong = 0;
      timeLeft = 60;

      startBtn.classList.add('hidden');
      resultsEl.classList.add('hidden');
      timerEl.classList.remove('hidden');
      problemEl.classList.remove('hidden');
      answerEl.classList.remove('hidden');
      keypadEl.classList.remove('hidden');
      submitBtn.classList.remove('hidden');

      timerEl.textContent = `‚è± ${timeLeft}`;
      answerEl.value = '';
      randomProblem();

      timerId = setInterval(() => {
        timeLeft--;
        timerEl.textContent = `‚è± ${timeLeft}`;
        updateProgressBar();
        if (timeLeft <= 0) endGame();
      }, 1000);

      progressContainer.classList.remove('hidden');
    }

    function endGame() {
      clearInterval(timerId);

      timerEl.classList.add('hidden');
      problemEl.classList.add('hidden');
      answerEl.classList.add('hidden');
      keypadEl.classList.add('hidden');
      submitBtn.classList.add('hidden');

      const score = correct - wrong;
      const duration = 60;
      const speed = score < 0 ? 0 : (score / duration).toFixed(2);
      
      resultsEl.innerHTML = `üèÅ Score: <strong>${score}</strong><br>‚ö° Speed: <strong>${speed}</strong> pts/sec<br><br>‚úÖ Correct: <strong>${correct}</strong><br>‚ùå Wrong: <strong>${wrong}</strong>`;
      resultsEl.classList.remove('hidden');

      startBtn.textContent = 'Play Again';
      startBtn.classList.remove('hidden');
      progressContainer.classList.add('hidden');

    }

    function buildKeypad() {
      const keys = ['1','2','3','4','5','6','7','8','9','E','0','‚å´'];
      keys.forEach(key => {
        btn = document.createElement('button');
        btn.textContent = key;
        btn.addEventListener('click', () => {
          if (key === '‚å´') {
            answerEl.value = answerEl.value.slice(0, -1);
          } else {
            answerEl.value += key;
          }
        });
        if (key === 'E') {
          btn = document.createElement('span');
        }
        keypadEl.appendChild(btn);
      });
    }

    document.addEventListener('keydown', (e) => {
      if (answerEl.classList.contains('hidden')) return;

      if (e.key >= '0' && e.key <= '9') {
        answerEl.value += e.key;
      }

      if (e.key === 'Backspace') {
        answerEl.value = answerEl.value.slice(0, -1);
      }

      if (e.key === 'Enter') {
        submitAnswer();
      }
    });

    startBtn.addEventListener('click', startGame);
    submitBtn.addEventListener('click', submitAnswer);

    buildKeypad();
  </script>
</body>
</html>
